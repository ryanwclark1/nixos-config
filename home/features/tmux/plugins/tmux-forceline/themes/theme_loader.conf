# vim:set ft=tmux:
# Theme Loader for tmux-forceline
# Handles dynamic theme loading and validation

# Default theme fallback
%if "#{==:#{@forceline_theme},}"
  set -g @forceline_theme "catppuccin-frappe"
%endif

# Theme validation and loading
%if "#{==:#{@forceline_theme},catppuccin-frappe}"
  source -F "#{d:current_file}/base24/catppuccin-frappe.conf"
%elif "#{==:#{@forceline_theme},dracula}"
  source -F "#{d:current_file}/base24/dracula.conf"
%elif "#{==:#{@forceline_theme},custom}"
  # Load user-defined custom theme if it exists
  %if "#{!=:#{@forceline_custom_theme_path},}"
    source -F "#{E:@forceline_custom_theme_path}"
  %else
    # Fallback to default if custom path not set
    source -F "#{d:current_file}/base24/catppuccin-frappe.conf"
    display-message "Warning: Custom theme path not set, falling back to catppuccin-frappe"
  %endif
%else
  # Unknown theme, fallback to default
  source -F "#{d:current_file}/base24/catppuccin-frappe.conf"
  display-message "Warning: Unknown theme '#{@forceline_theme}', falling back to catppuccin-frappe"
%endif

# Set theme-loaded flag for dependent configurations
set -g @forceline_theme_loaded "yes"

# Initialize theme-specific status background
%if "#{==:#{@forceline_status_background},default}"
  set -gF @_fl_status_bg "#{@fl_mantle}"
  set -gF status-style "bg=#{@_fl_status_bg},fg=#{@fl_fg}"
%elif "#{==:#{@forceline_status_background},none}"
  set -g status-style "default"
  set -g @_fl_status_bg "none"
%else
  # Treat @forceline_status_background as a format string
  set -gF status-style "bg=#{E:@forceline_status_background},fg=#{@fl_fg}"
  set -gF @_fl_status_bg "#{E:@forceline_status_background}"
%endif