# vim:set ft=tmux:
# Battery Status Module for tmux-forceline v2.0
# Integrated with Base24 theming and dynamic colors

%hidden MODULE_NAME="battery"

# Battery configuration options
set -ogq @forceline_battery_show_percentage "yes"
set -ogq @forceline_battery_show_status "yes"
set -ogq @forceline_battery_low_threshold "20"
set -ogq @forceline_battery_critical_threshold "10"

# Modern Nerd Font battery icons (configurable)
set -ogq @batt_icon_charge_tier8 "󰁹"  # 100%
set -ogq @batt_icon_charge_tier7 "󰂁"  # 90%
set -ogq @batt_icon_charge_tier6 "󰁿"  # 80%
set -ogq @batt_icon_charge_tier5 "󰁾"  # 70%
set -ogq @batt_icon_charge_tier4 "󰁽"  # 60%
set -ogq @batt_icon_charge_tier3 "󰁼"  # 50%
set -ogq @batt_icon_charge_tier2 "󰁻"  # 30%
set -ogq @batt_icon_charge_tier1 "󰁺"  # 10% (critical)

# Status icons
set -ogq @batt_icon_status_charged "󰚥"     # fully charged
set -ogq @batt_icon_status_charging "󰂄"   # charging
set -ogq @batt_icon_status_discharging "󰂃" # discharging (if needed)
set -ogq @batt_icon_status_unknown "󰂑"    # unknown status
set -ogq @batt_icon_status_attached "󱈑"   # attached/plugged

# Base24 color configuration for battery states
set -ogq @forceline_battery_normal_fg "#{@fl_fg}"
set -ogq @forceline_battery_low_fg "#{@fl_base00}"
set -ogq @forceline_battery_critical_fg "#{@fl_base00}"
set -ogq @forceline_battery_charging_fg "#{@fl_base00}"

set -ogq @forceline_battery_normal_bg "#{@fl_surface_0}"
set -ogq @forceline_battery_low_bg "#{@fl_warning}"      # orange
set -ogq @forceline_battery_critical_bg "#{@fl_error}"   # red
set -ogq @forceline_battery_charging_bg "#{@fl_success}" # green

# Setup battery monitoring using the modules system
run-shell "#{d:current_file}/../modules/battery/battery.tmux"

# Dynamic color selection using our battery module functions
set -ogq @forceline_battery_fg_color "#(#{d:current_file}/../modules/battery/scripts/battery_color.sh fg)"
set -ogq @forceline_battery_bg_color "#(#{d:current_file}/../modules/battery/scripts/battery_color.sh bg)"

# Plugin configuration using our battery module functions
set -ogq "@forceline_${MODULE_NAME}_icon" "#(#{d:current_file}/../modules/battery/scripts/battery_icon.sh) "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base07}"  # lavender theme (fallback)
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_battery_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_battery_bg_color}"

# Battery display format
%if "#{==:#{@forceline_battery_show_percentage},yes}"
  set -ogq "@forceline_${MODULE_NAME}_text" " #(#{d:current_file}/../modules/battery/scripts/battery_percentage.sh)"
%else
  set -ogq "@forceline_${MODULE_NAME}_text" ""
%endif

# Load the universal status module renderer
source -F "#{d:current_file}/../utils/status_module.conf"
