# vim:set ft=tmux:
# GPU Plugin for tmux-forceline
# Graphics card utilization and temperature monitoring with multi-vendor support

%hidden MODULE_NAME="gpu"

# Plugin metadata
set -g @_fl_plugin_gpu_version "2.1.0"
set -g @_fl_plugin_gpu_description "GPU utilization and temperature monitoring"

# GPU monitoring configuration
set -ogq @forceline_gpu_temp_enabled "yes"
set -ogq @forceline_gpu_temp_unit "celsius"  # celsius, fahrenheit
set -ogq @forceline_gpu_update_interval "2"
set -ogq @forceline_gpu_high_threshold "80"
set -ogq @forceline_gpu_critical_threshold "90"

# Multi-vendor GPU support
set -ogq @forceline_gpu_nvidia_enabled "yes"
set -ogq @forceline_gpu_amd_enabled "yes"
set -ogq @forceline_gpu_intel_enabled "yes"

# Base24 color configuration
set -ogq @forceline_gpu_low_fg "#{@fl_fg}"
set -ogq @forceline_gpu_medium_fg "#{@fl_fg}"
set -ogq @forceline_gpu_high_fg "#{@fl_base00}"
set -ogq @forceline_gpu_critical_fg "#{@fl_base00}"

set -ogq @forceline_gpu_low_bg "#{@fl_surface_0}"
set -ogq @forceline_gpu_medium_bg "#{@fl_base0E}"  # magenta
set -ogq @forceline_gpu_high_bg "#{@fl_base09}"    # orange
set -ogq @forceline_gpu_critical_bg "#{@fl_base08}" # red

# Dynamic color selection based on GPU usage
set -ogq @forceline_gpu_fg_color "#{@forceline_gpu_low_fg}"
set -ogq @forceline_gpu_bg_color "#{@forceline_gpu_low_bg}"

# Plugin configuration
set -ogq "@forceline_${MODULE_NAME}_icon" "ó°¾² "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0E}"  # magenta theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_gpu_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_gpu_bg_color}"

# GPU display format using new modular structure with centralized paths
set -ogq "@forceline_${MODULE_NAME}_text" " #{@forceline_dir}/modules/gpu/scripts/gpu_percentage.sh"

# Initialize GPU module interpolation mappings using centralized path
run-shell "#{@forceline_dir}/modules/gpu/gpu.sh"

# Load the universal status module renderer using centralized path
source -F "#{@forceline_dir}/utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "gpu_monitoring,temperature_monitoring,multi_vendor_support,dynamic_colors"