# vim:set ft=tmux:
# Battery Plugin for tmux-forceline
# Cross-platform battery monitoring with dynamic colors

%hidden MODULE_NAME="battery"

# Plugin metadata
set -g @_fl_plugin_battery_version "2.0.0"
set -g @_fl_plugin_battery_description "Cross-platform battery monitoring with status-based theming"

# Battery monitoring configuration
set -ogq @forceline_battery_show_percentage "yes"
set -ogq @forceline_battery_show_status "yes"
set -ogq @forceline_battery_low_threshold "20"
set -ogq @forceline_battery_critical_threshold "10"
set -ogq @forceline_battery_update_interval "5"

# Base24 color configuration for battery states
set -ogq @forceline_battery_normal_fg "#{@fl_fg}"
set -ogq @forceline_battery_low_fg "#{@fl_base00}"
set -ogq @forceline_battery_critical_fg "#{@fl_base00}"
set -ogq @forceline_battery_charging_fg "#{@fl_base00}"

set -ogq @forceline_battery_normal_bg "#{@fl_surface_0}"
set -ogq @forceline_battery_low_bg "#{@fl_warning}"      # orange
set -ogq @forceline_battery_critical_bg "#{@fl_error}"   # red
set -ogq @forceline_battery_charging_bg "#{@fl_success}" # green

# Dynamic color selection based on battery level and charging status
set -ogq @forceline_battery_fg_color "#{@forceline_battery_normal_fg}"
set -ogq @forceline_battery_bg_color "#{@forceline_battery_normal_bg}"

# Plugin configuration using full absolute paths
set -ogq "@forceline_${MODULE_NAME}_icon" "#(/home/administrator/.config/tmux/plugins/tmux-forceline/modules/battery/scripts/battery_icon.sh) "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0B}"  # green theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_battery_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_battery_bg_color}"

# Battery display format using full absolute path
set -ogq "@forceline_${MODULE_NAME}_text" " #(/home/administrator/.config/tmux/plugins/tmux-forceline/modules/battery/scripts/battery_percentage.sh)"

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "battery_monitoring,cross_platform,dynamic_colors,status_detection"