# vim:set ft=tmux:
# Load Plugin for tmux-forceline
# Cross-platform system load monitoring with dynamic colors

%hidden MODULE_NAME="load"

# Plugin metadata
set -g @_fl_plugin_load_version "2.0.0"
set -g @_fl_plugin_load_description "Cross-platform system load monitoring with dynamic colors"

# Load monitoring configuration
set -ogq @forceline_load_format "average"       # average, 1min, 5min, 15min, compact
set -ogq @forceline_load_precision "1"          # Decimal precision
set -ogq @forceline_load_show_color "yes"       # Enable color coding based on load
set -ogq @forceline_load_high_threshold "0.8"   # High load threshold (ratio to CPU cores)
set -ogq @forceline_load_critical_threshold "1.5" # Critical load threshold (ratio to CPU cores)

# Base24 color configuration for load states
set -ogq @forceline_load_normal_fg "#{@fl_fg}"
set -ogq @forceline_load_high_fg "#{@fl_base00}"
set -ogq @forceline_load_critical_fg "#{@fl_base00}"

set -ogq @forceline_load_normal_bg "#{@fl_surface_0}"
set -ogq @forceline_load_high_bg "#{@fl_warning}"      # orange
set -ogq @forceline_load_critical_bg "#{@fl_error}"    # red

# Dynamic color selection simplified for now
set -ogq @forceline_load_fg_color "#{@forceline_load_normal_fg}"
set -ogq @forceline_load_bg_color "#{@forceline_load_normal_bg}"

# Plugin configuration using standard tmux variables
set -ogq "@forceline_${MODULE_NAME}_icon" "ó°Šš "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0A}"  # yellow theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_load_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_load_bg_color}"

# Load display format using standard tmux loadavg
set -ogq "@forceline_${MODULE_NAME}_text" " #(uptime | awk '{print $(NF-2) $(NF-1) $NF}' | sed 's/,//g')"

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "load_monitoring,cross_platform,dynamic_colors,cpu_aware"