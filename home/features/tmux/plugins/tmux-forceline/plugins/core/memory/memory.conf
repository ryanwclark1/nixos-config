# vim:set ft=tmux:
# Memory Plugin for tmux-forceline
# RAM and swap monitoring with usage-based theming

%hidden MODULE_NAME="memory"

# Plugin metadata
set -g @_fl_plugin_memory_version "2.0.0"
set -g @_fl_plugin_memory_description "RAM and swap usage monitoring"

# Memory monitoring configuration
set -ogq @forceline_memory_format "percentage"  # percentage, absolute, both
set -ogq @forceline_memory_unit "GB"           # GB, MB, auto
set -ogq @forceline_memory_swap_enabled "yes"
set -ogq @forceline_memory_high_threshold "80"
set -ogq @forceline_memory_critical_threshold "95"

# Base24 color configuration
set -ogq @forceline_memory_low_fg "#{@fl_fg}"
set -ogq @forceline_memory_medium_fg "#{@fl_fg}"
set -ogq @forceline_memory_high_fg "#{@fl_base00}"
set -ogq @forceline_memory_critical_fg "#{@fl_base00}"

set -ogq @forceline_memory_low_bg "#{@fl_surface_0}"
set -ogq @forceline_memory_medium_bg "#{@fl_base0C}"  # cyan
set -ogq @forceline_memory_high_bg "#{@fl_base09}"    # orange
set -ogq @forceline_memory_critical_bg "#{@fl_base08}" # red

# Dynamic color selection simplified for now
set -ogq @forceline_memory_fg_color "#{@forceline_memory_low_fg}"
set -ogq @forceline_memory_bg_color "#{@forceline_memory_low_bg}"

# Plugin configuration
set -ogq "@forceline_${MODULE_NAME}_icon" "ó°˜š "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0C}"  # cyan theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_memory_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_memory_bg_color}"

# Memory display format using new modular structure with centralized paths
set -ogq "@forceline_${MODULE_NAME}_text" " #{@forceline_dir}/modules/memory/scripts/memory_percentage.sh"

# Initialize memory module interpolation mappings using centralized path
run-shell "#{@forceline_dir}/modules/memory/memory.sh"

# Load the universal status module renderer using centralized path
source -F "#{@forceline_dir}/utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "memory_monitoring,swap_monitoring,dynamic_colors"