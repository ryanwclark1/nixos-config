# vim:set ft=tmux:
# Directory Plugin for tmux-forceline
# Displays current working directory with intelligent truncation

%hidden MODULE_NAME="directory"

# Plugin metadata
set -g @_fl_plugin_directory_version "2.0.0"
set -g @_fl_plugin_directory_description "Current working directory display with smart truncation"

# Directory display configuration
set -ogq @forceline_directory_max_length "25"
set -ogq @forceline_directory_show_home_symbol "yes"
set -ogq @forceline_directory_truncate_style "middle"  # start, middle, end
set -ogq @forceline_directory_show_git_root "yes"
set -ogq @forceline_directory_rolling_text "yes"

# Base24 color configuration for different directory states
set -ogq @forceline_directory_normal_fg "#{@fl_fg}"
set -ogq @forceline_directory_git_fg "#{@fl_base00}"
set -ogq @forceline_directory_home_fg "#{@fl_base00}"
set -ogq @forceline_directory_root_fg "#{@fl_base00}"

set -ogq @forceline_directory_normal_bg "#{@fl_surface_0}"
set -ogq @forceline_directory_git_bg "#{@fl_info}"      # cyan - git repository
set -ogq @forceline_directory_home_bg "#{@fl_success}"  # green - home directory
set -ogq @forceline_directory_root_bg "#{@fl_error}"    # red - root directory

# Dynamic color selection based on directory type
set -ogq @forceline_directory_fg_color "#(pwd | grep -q \"^$HOME\" && echo '#{@forceline_directory_home_fg}' || [ \"$(pwd)\" = \"/\" ] && echo '#{@forceline_directory_root_fg}' || git rev-parse --git-dir >/dev/null 2>&1 && echo '#{@forceline_directory_git_fg}' || echo '#{@forceline_directory_normal_fg}')"

set -ogq @forceline_directory_bg_color "#(pwd | grep -q \"^$HOME\" && echo '#{@forceline_directory_home_bg}' || [ \"$(pwd)\" = \"/\" ] && echo '#{@forceline_directory_root_bg}' || git rev-parse --git-dir >/dev/null 2>&1 && echo '#{@forceline_directory_git_bg}' || echo '#{@forceline_directory_normal_bg}')"

# Plugin configuration
set -ogq "@forceline_${MODULE_NAME}_icon" " "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_info}"  # cyan theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_directory_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_directory_bg_color}"

# Directory display format with smart truncation
%if "#{==:#{@forceline_directory_show_home_symbol},yes}"
  set -ogq "@forceline_${MODULE_NAME}_text" " #{=#{@forceline_directory_max_length}:#{s|$HOME|~|:pane_current_path}}"
%else
  set -ogq "@forceline_${MODULE_NAME}_text" " #{=#{@forceline_directory_max_length}:pane_current_path}"
%endif

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "directory_monitoring,git_detection,smart_truncation,dynamic_colors"