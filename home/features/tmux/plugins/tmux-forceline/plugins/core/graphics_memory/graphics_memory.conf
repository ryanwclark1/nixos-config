# vim:set ft=tmux:
# Graphics Memory Plugin for tmux-forceline
# VRAM and GPU memory monitoring with multi-vendor support

%hidden MODULE_NAME="graphics_memory"

# Plugin metadata
set -g @_fl_plugin_graphics_memory_version "2.1.0"
set -g @_fl_plugin_graphics_memory_description "GPU VRAM and graphics memory monitoring"

# Graphics memory monitoring configuration
set -ogq @forceline_graphics_memory_format "percentage"  # percentage, absolute, both
set -ogq @forceline_graphics_memory_unit "GB"           # GB, MB, auto
set -ogq @forceline_graphics_memory_update_interval "3"
set -ogq @forceline_graphics_memory_high_threshold "80"
set -ogq @forceline_graphics_memory_critical_threshold "95"

# Multi-vendor graphics memory support
set -ogq @forceline_graphics_memory_nvidia_enabled "yes"
set -ogq @forceline_graphics_memory_amd_enabled "yes"
set -ogq @forceline_graphics_memory_intel_enabled "yes"
set -ogq @forceline_graphics_memory_macos_enabled "yes"

# Base24 color configuration
set -ogq @forceline_graphics_memory_low_fg "#{@fl_fg}"
set -ogq @forceline_graphics_memory_medium_fg "#{@fl_fg}"
set -ogq @forceline_graphics_memory_high_fg "#{@fl_base00}"
set -ogq @forceline_graphics_memory_critical_fg "#{@fl_base00}"

set -ogq @forceline_graphics_memory_low_bg "#{@fl_surface_0}"
set -ogq @forceline_graphics_memory_medium_bg "#{@fl_base0D}"  # blue
set -ogq @forceline_graphics_memory_high_bg "#{@fl_base09}"    # orange
set -ogq @forceline_graphics_memory_critical_bg "#{@fl_base08}" # red

# Dynamic color selection based on graphics memory usage
set -ogq @forceline_graphics_memory_fg_color "#{@forceline_graphics_memory_low_fg}"
set -ogq @forceline_graphics_memory_bg_color "#{@forceline_graphics_memory_low_bg}"

# Plugin configuration
set -ogq "@forceline_${MODULE_NAME}_icon" "ðŸŽ® "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0D}"  # blue theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_graphics_memory_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_graphics_memory_bg_color}"

# Graphics memory display format using new modular structure with centralized paths
set -ogq "@forceline_${MODULE_NAME}_text" " #{@forceline_dir}/modules/graphics_memory/scripts/graphics_memory_percentage.sh"

# Initialize graphics_memory module interpolation mappings using centralized path
run-shell "#{@forceline_dir}/modules/graphics_memory/graphics_memory.sh"

# Load the universal status module renderer using centralized path
source -F "#{@forceline_dir}/utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "graphics_memory_monitoring,vram_monitoring,multi_vendor_support,dynamic_colors"