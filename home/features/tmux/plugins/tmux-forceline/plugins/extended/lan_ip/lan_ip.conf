# vim:set ft=tmux:
# LAN IP Plugin for tmux-forceline
# Enhanced local network IP detection with interface selection

%hidden MODULE_NAME="lan_ip"

# Plugin metadata
set -g @_fl_plugin_lan_ip_version "2.0.0"
set -g @_fl_plugin_lan_ip_description "Local network IP detection with interface selection"

# LAN IP configuration
set -ogq @forceline_lan_ip_format "primary"         # primary, all
set -ogq @forceline_lan_ip_interface ""             # Specific interface (empty for auto-detect)
set -ogq @forceline_lan_ip_show_interface "no"      # Show interface name with IP

# Base24 color configuration for LAN IP
set -ogq @forceline_lan_ip_fg "#{@fl_fg}"
set -ogq @forceline_lan_ip_bg "#{@fl_surface_0}"

# Plugin configuration using LAN IP format variables
set -ogq "@forceline_${MODULE_NAME}_icon" "ó°›³ "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0B}"  # green theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_lan_ip_fg}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_lan_ip_bg}"

# LAN IP display format using ip command
set -ogq "@forceline_${MODULE_NAME}_text" " #(ip route get 1.1.1.1 | grep -oP 'src \K\S+' 2>/dev/null || echo 'N/A')"

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "lan_ip_detection,interface_selection,cross_platform"