# vim:set ft=tmux:
# VCS Plugin for tmux-forceline
# Enhanced Git integration with status monitoring and dynamic colors

%hidden MODULE_NAME="vcs"

# Plugin metadata
set -g @_fl_plugin_vcs_version "2.0.0"
set -g @_fl_plugin_vcs_description "Git integration with status monitoring and dynamic colors"

# VCS display configuration
set -ogq @forceline_vcs_show_icon "yes"           # Show VCS type icon
set -ogq @forceline_vcs_branch_max_len "20"       # Maximum branch name length
set -ogq @forceline_vcs_truncate_symbol "â€¦"       # Symbol for truncated branch names
set -ogq @forceline_vcs_show_symbols "yes"        # Use symbols for status counts
set -ogq @forceline_vcs_show_zero "no"            # Show zero counts
set -ogq @forceline_vcs_format "branch"           # branch, status, type, full

# Base24 color configuration for VCS states
set -ogq @forceline_vcs_clean_fg "#{@fl_fg}"
set -ogq @forceline_vcs_staged_fg "#{@fl_base00}"
set -ogq @forceline_vcs_diverged_fg "#{@fl_base00}"
set -ogq @forceline_vcs_dirty_fg "#{@fl_base00}"

set -ogq @forceline_vcs_clean_bg "#{@fl_success}"     # green - clean repository
set -ogq @forceline_vcs_staged_bg "#{@fl_info}"       # blue - staged changes
set -ogq @forceline_vcs_diverged_bg "#{@fl_warning}"  # orange - ahead/behind
set -ogq @forceline_vcs_dirty_bg "#{@fl_error}"       # red - dirty working tree

# Dynamic color selection simplified for now
set -ogq @forceline_vcs_fg_color "#{@forceline_vcs_clean_fg}"
set -ogq @forceline_vcs_bg_color "#{@forceline_vcs_clean_bg}"

# Plugin configuration using direct script calls
set -ogq "@forceline_${MODULE_NAME}_icon" ""
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0D}"  # blue theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_vcs_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_vcs_bg_color}"

# VCS display format using full absolute path
set -ogq "@forceline_${MODULE_NAME}_text" " #(/home/administrator/.config/tmux/plugins/tmux-forceline/modules/vcs/scripts/vcs_branch.sh)"

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "vcs_integration,git_support,status_monitoring,branch_detection,dynamic_colors"