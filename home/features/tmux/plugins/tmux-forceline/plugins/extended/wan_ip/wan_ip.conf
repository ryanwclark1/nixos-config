# vim:set ft=tmux:
# WAN IP Plugin for tmux-forceline
# Enhanced WAN IP detection with intelligent caching and multiple providers

%hidden MODULE_NAME="wan_ip"

# Plugin metadata
set -g @_fl_plugin_wan_ip_version "2.0.0"
set -g @_fl_plugin_wan_ip_description "WAN IP detection with intelligent caching and multiple providers"

# WAN IP configuration
set -ogq @forceline_wan_ip_cache_ttl "900"           # Cache TTL in seconds (15 minutes)
set -ogq @forceline_wan_ip_timeout "3"              # Request timeout in seconds
set -ogq @forceline_wan_ip_providers "ipify,icanhazip,checkip"  # Comma-separated providers
set -ogq @forceline_wan_ip_show_status "no"         # Show cache status (FRESH/CACHED/STALE)

# Base24 color configuration for WAN IP states
set -ogq @forceline_wan_ip_online_fg "#{@fl_fg}"
set -ogq @forceline_wan_ip_cached_fg "#{@fl_fg}"
set -ogq @forceline_wan_ip_stale_fg "#{@fl_base00}"
set -ogq @forceline_wan_ip_offline_fg "#{@fl_base00}"

set -ogq @forceline_wan_ip_online_bg "#{@fl_success}"     # green - fresh IP
set -ogq @forceline_wan_ip_cached_bg "#{@fl_surface_0}"   # normal - cached IP
set -ogq @forceline_wan_ip_stale_bg "#{@fl_warning}"      # orange - stale cache
set -ogq @forceline_wan_ip_offline_bg "#{@fl_error}"      # red - failed to fetch

# Dynamic color selection based on WAN IP status
set -ogq @forceline_wan_ip_fg_color "#{wan_ip_color_fg}"
set -ogq @forceline_wan_ip_bg_color "#{wan_ip_color_bg}"

# Plugin configuration using WAN IP format variables
set -ogq "@forceline_${MODULE_NAME}_icon" "ó°–‚ "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0C}"  # cyan theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_wan_ip_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_wan_ip_bg_color}"

# WAN IP display format
set -ogq "@forceline_${MODULE_NAME}_text" " #{wan_ip}"

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "wan_ip_detection,intelligent_caching,multiple_providers,status_indication"