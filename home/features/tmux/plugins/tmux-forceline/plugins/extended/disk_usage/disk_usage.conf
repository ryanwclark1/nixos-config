# vim:set ft=tmux:
# Disk Usage Plugin for tmux-forceline
# Enhanced disk monitoring with configurable paths and threshold-based colors

%hidden MODULE_NAME="disk_usage"

# Plugin metadata
set -g @_fl_plugin_disk_usage_version "2.0.0"
set -g @_fl_plugin_disk_usage_description "Disk usage monitoring with configurable paths and thresholds"

# Disk usage configuration
set -ogq @forceline_disk_usage_path "/"              # Path to monitor (default: root)
set -ogq @forceline_disk_usage_format "percentage"   # percentage, used, available, size, compact, full
set -ogq @forceline_disk_usage_show_path "no"        # Show path in output
set -ogq @forceline_disk_usage_warning_threshold "80"    # Warning threshold percentage
set -ogq @forceline_disk_usage_critical_threshold "90"   # Critical threshold percentage

# Base24 color configuration for disk usage states
set -ogq @forceline_disk_usage_normal_fg "#{@fl_fg}"
set -ogq @forceline_disk_usage_warning_fg "#{@fl_base00}"
set -ogq @forceline_disk_usage_critical_fg "#{@fl_base00}"

set -ogq @forceline_disk_usage_normal_bg "#{@fl_surface_0}"
set -ogq @forceline_disk_usage_warning_bg "#{@fl_warning}"    # orange
set -ogq @forceline_disk_usage_critical_bg "#{@fl_error}"     # red

# Dynamic color selection based on disk usage percentage
set -ogq @forceline_disk_usage_fg_color "#(disk_status=$(#{disk_usage_status} | cut -d':' -f1); case \"$disk_status\" in CRITICAL) echo '#{@forceline_disk_usage_critical_fg}' ;; WARNING) echo '#{@forceline_disk_usage_warning_fg}' ;; *) echo '#{@forceline_disk_usage_normal_fg}' ;; esac)"

set -ogq @forceline_disk_usage_bg_color "#(disk_status=$(#{disk_usage_status} | cut -d':' -f1); case \"$disk_status\" in CRITICAL) echo '#{@forceline_disk_usage_critical_bg}' ;; WARNING) echo '#{@forceline_disk_usage_warning_bg}' ;; *) echo '#{@forceline_disk_usage_normal_bg}' ;; esac)"

# Plugin configuration using disk usage format variables
set -ogq "@forceline_${MODULE_NAME}_icon" "ó°‹Š "
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base09}"  # orange theme
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_disk_usage_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_disk_usage_bg_color}"

# Disk usage display format
set -ogq "@forceline_${MODULE_NAME}_text" " #{disk_usage}"

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities
set -ag @_fl_plugin_capabilities "disk_monitoring,configurable_paths,threshold_colors,multiple_formats"