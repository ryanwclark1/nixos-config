# vim:set ft=tmux:
# Transient Status Plugin for tmux-forceline
# Dynamic status indicators for temporary system conditions and user notifications

%hidden MODULE_NAME="transient"

# Plugin metadata
set -g @_fl_plugin_transient_version "2.1.0"
set -g @_fl_plugin_transient_description "Dynamic transient status indicators for system conditions and notifications"

# Transient status configuration
set -ogq @forceline_transient_enabled "true"               # Enable/disable transient status
set -ogq @forceline_transient_duration "10"               # Default duration in seconds
set -ogq @forceline_transient_priority "medium"           # Default priority: high, medium, low
set -ogq @forceline_transient_position "left"             # Position: left, right, center
set -ogq @forceline_transient_max_length "40"             # Maximum message length

# System condition monitoring
set -ogq @forceline_transient_battery_enabled "true"      # Monitor battery level
set -ogq @forceline_transient_battery_threshold "15"      # Battery warning threshold %
set -ogq @forceline_transient_memory_enabled "true"       # Monitor memory usage
set -ogq @forceline_transient_memory_threshold "90"       # Memory warning threshold %
set -ogq @forceline_transient_cpu_enabled "true"          # Monitor CPU load
set -ogq @forceline_transient_cpu_threshold "80"          # CPU warning threshold %
set -ogq @forceline_transient_network_enabled "true"      # Monitor network connectivity
set -ogq @forceline_transient_disk_enabled "true"         # Monitor disk usage
set -ogq @forceline_transient_disk_threshold "90"         # Disk warning threshold %

# Base24 color configuration for different priority levels
set -ogq @forceline_transient_high_fg "#{@fl_base07}"      # High priority foreground (white)
set -ogq @forceline_transient_high_bg "#{@fl_error}"       # High priority background (red)
set -ogq @forceline_transient_medium_fg "#{@fl_base00}"    # Medium priority foreground (dark)
set -ogq @forceline_transient_medium_bg "#{@fl_warning}"   # Medium priority background (orange)
set -ogq @forceline_transient_low_fg "#{@fl_base00}"       # Low priority foreground (dark)
set -ogq @forceline_transient_low_bg "#{@fl_success}"      # Low priority background (green)
set -ogq @forceline_transient_info_fg "#{@fl_base07}"      # Info priority foreground (white)
set -ogq @forceline_transient_info_bg "#{@fl_base0D}"      # Info priority background (blue)

# Icons for different status types
set -ogq @forceline_transient_success_icon "‚úÖ"
set -ogq @forceline_transient_warning_icon "‚ö†Ô∏è"
set -ogq @forceline_transient_error_icon "‚ùå"
set -ogq @forceline_transient_info_icon "‚ÑπÔ∏è"
set -ogq @forceline_transient_battery_icon "üîã"
set -ogq @forceline_transient_memory_icon "üß†"
set -ogq @forceline_transient_cpu_icon "‚ö°"
set -ogq @forceline_transient_network_icon "üåê"
set -ogq @forceline_transient_disk_icon "üíæ"

# Dynamic color selection based on priority (will be determined at runtime)
set -ogq @forceline_transient_fg_color "#{@forceline_transient_medium_fg}"
set -ogq @forceline_transient_bg_color "#{@forceline_transient_medium_bg}"

# Plugin configuration using dynamic status script
set -ogq "@forceline_${MODULE_NAME}_icon" ""
set -ogq "@forceline_${MODULE_NAME}_color" "#{@fl_base0D}"  # Blue theme for info
set -ogq "@forceline_${MODULE_NAME}_text_fg" "#{@forceline_transient_fg_color}"
set -ogq "@forceline_${MODULE_NAME}_text_bg" "#{@forceline_transient_bg_color}"

# Transient status display format using enhanced script
set -ogq "@forceline_${MODULE_NAME}_text" "#(/home/administrator/nixos-config/home/features/tmux/plugins/tmux-forceline/modules/transient/transient.sh)"

# Conditional display - only show when there's an active transient status
set -ogq "@forceline_${MODULE_NAME}_condition" "#{s/^$//:#{@forceline_${MODULE_NAME}_text}}"

# Load the universal status module renderer
source -F "#{d:current_file}/../../utils/status_module.conf"

# Register plugin capabilities  
set -ag @_fl_plugin_capabilities "transient_status,system_monitoring,user_notifications,priority_system"

# Helper functions for other scripts to trigger transient status
# Usage examples:
# tmux run-shell "/path/to/transient.sh success 'Build completed successfully' 5"
# tmux run-shell "/path/to/transient.sh error 'Build failed' 15"
# tmux run-shell "/path/to/transient.sh warning 'Deployment in progress' 30"
# tmux run-shell "/path/to/transient.sh info 'Cache cleared' 8"
# tmux run-shell "/path/to/transient.sh clear"  # Clear all transient statuses